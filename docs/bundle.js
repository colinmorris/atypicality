!function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=8)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.sonic_attrs=["energy","acousticness","liveness","speechiness","instrumentalness","valence","danceability","tempo"],t.typicality_cmap=d3.scaleLinear().domain([.5,1]).range(["#ff00c7","#000"]).interpolate(d3.interpolateLab),t.year_range=[1958,2016],t.contrast_color="red"},function(e,t,n){"use strict";function i(){return new Promise(function(e,n){d3.csv("assets/number_ones.csv",o.Song.fromRow,function(n){t.db=a=n,e()})})}function r(e){var t=a.filter(function(t){return t.track==e});return console.assert(1==t.length,"Ambiguous/Unknown track "+e),t[0]}Object.defineProperty(t,"__esModule",{value:!0}),t.lookup=t.db=t.load=void 0;var o=n(5),a=void 0;t.load=i,t.db=a,t.lookup=r},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.RadarChart=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n(0),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(o),s=a.sonic_attrs,l={acousticness:"The likelihood that this song was recorded solely by acoustic means (as opposed to more electronic means)",danceability:"How suitable is this track for dancing? Includes tempo, regularity of beat, and beat strength",energy:"A perceptual measure of intensity throughout the track. Think fast, loud and noisy (e.g. hard rock) more than dance tracks.",instrumentalness:"The likelihood that this track is predominantly instrumental. Not necessarily the inverse of speechiness.",liveness:"Detects the presence of a live audience during the recording. Heavily studio-produced tracks score low on this measure.",speechiness:"Detects the presence of spoken word throughout the track. Sung vocals are not considered spoken word.",tempo:"The overall average tempo of the track (i.e. bpm)",valence:"The musical positiveness of the track."},c=s.map(function(e){return"mean_"+e}),u=["focal","baseline","contrast"],d=function(){function e(t){var n=this;i(this,e),this.root=t;var r={W:500,H:500},o=r.W,a=r.H;this.root.attr("viewBox","0 0 "+r.W+" "+r.H),this.root.attr("preserveAspectRatio","xMidYMid"),this.origin={x:o/2,y:a/2};var c=.45*Math.min(o,a);this.scales=s.map(function(e,t){return d3.scaleLinear().domain([0,1]).range([[n.origin.x,n.origin.y],[n.origin.x+c*Math.cos(2*t*Math.PI/s.length),n.origin.y+c*Math.sin(2*t*Math.PI/s.length)]])});var u=this.root.selectAll(".axis").data(this.scales).enter().append("g").classed("axis",!0);this.axes=u,u.append("line").attr("x1",function(e){return e.range()[0][0]}).attr("x2",function(e){return e.range()[1][0]}).attr("y1",function(e){return e.range()[0][1]}).attr("y2",function(e){return e.range()[1][1]}),this.axis_labels=u.append("text").attr("x",function(e){return e.range()[1][0]}).attr("y",function(e){return e.range()[1][1]}).datum(function(e,t){return s[t]}).text(function(e){return e}),this.axis_labels.append("title").text(function(e,t){return l[s[t]]}),this._setupDummyWebs()}return r(e,[{key:"_dummify",value:function(e){var t={duration:1e3,ease:d3.easeCubicIn};this._transitionPoints(this._dummyPoints,this.getWeb(e),t)}},{key:"_setupDummyWebs",value:function(){this._plotPoints(this.root,this._dummyPoints,"contrast");var e=this._plotPoints(this.root,this._dummyPoints,"focal");this._plotPoints(e,this._dummyPoints,"baseline")}},{key:"setSonicHighlights",value:function(e){e&&console.debug("Setting sonic highlights to "+e),e=e?e.split(" "):[],this.axis_labels.classed("highlight",function(t){return e.includes(t)}),this.root.selectAll(".focal .marker").classed("highlight",function(t,n){var i=s[n];return e.includes(i)})}},{key:"unsetSonicHighlights",value:function(e){e=e?e.split(" "):[],this.axes.selectAll("text.highlight").classed("highlight",function(t){return!e.includes(t)}),this.root.selectAll(".focal .marker").classed("highlight",function(t,n,i){var r=s[n];return!e.includes(r)&&d3.select(i[n]).classed("highlight")})}},{key:"_pointsForSong",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=n?c:s;return e.getAttrs(i).map(function(e,n){return t.scales[n](e)})}},{key:"_plotPoints",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=e.append("g").classed(n,!0).classed("spiderweb",!0);return i.selectAll("circle").data(t).enter().append("circle").classed("marker",!0).attr("r",5).attr("cx",function(e){return e[0]}).attr("cy",function(e){return e[1]}),i.append("polygon").attr("points",t.join(",")),i}},{key:"_transitionPoints",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=t.attr("class").split(" "),r=void 0,o=!0,a=!1,s=void 0;try{for(var l,c=i[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var d=l.value;if(u.includes(d)){r=d;break}}}catch(e){a=!0,s=e}finally{try{!o&&c.return&&c.return()}finally{if(a)throw s}}var h=n.duration||1e3,f=n.ease||d3.easeCubic;console.assert(r),this.root.selectAll(".spiderweb."+r+" > circle.marker").data(e).transition().duration(h).ease(f).attr("cx",function(e){return e[0]}).attr("cy",function(e){return e[1]}),t.select("polygon").transition().duration(h).attr("points",e.join(","))}},{key:"getWeb",value:function(e){return this.root.select(".spiderweb."+e)}},{key:"getWebs",value:function(e){return this.root.selectAll(".spiderweb."+e)}},{key:"plotSong",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"focal",n=this._pointsForSong(e),i=this.root.select(".spiderweb."+t);if(i.empty()){if(console.log("No web found of cls "+t+", so making one from scratch."),i=this._plotPoints(this.root,n,t),"focal"==t){var r=this._pointsForSong(e,!0);this._plotPoints(i,r,"baseline")}}else if(this._transitionPoints(n,i),"focal"==t){var o=this._pointsForSong(e,!0),a=i.select(".baseline");this._transitionPoints(o,a)}return i}},{key:"clear",value:function(){console.warn("u sure u wanna clear?"),this.root.selectAll(".spiderweb").remove()}},{key:"decontrast",value:function(){this._dummify("contrast")}},{key:"contrast",value:function(e){this.plotSong(e,"contrast")}},{key:"transitionSong",value:function(e){e&&this.plotSong(e)}},{key:"setSong",value:function(e){e&&this.plotSong(e)}},{key:"_dummyPoints",get:function(){var e=this;return new Array(s.length).fill(0).map(function(t,n){return e.scales[n](t)})}}]),e}();t.RadarChart=d},function(e,t,n){"use strict";function i(e){return"[object Array]"===Object.prototype.toString.call(e)}e.exports=Array.isArray||i},function(e,t,n){"use strict";function i(e){return"function"==typeof e}e.exports=i},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Song=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n(15),a=function(e){return e&&e.__esModule?e:{default:e}}(o),s=n(0),l=s.sonic_attrs.map(function(e){return"mean_"+e}),c=["peak","wksonchart","typicality","typicality_all","typicality_orig","mode","raw_key","raw_time_signature","raw_tempo","typical_typicality_orig","typical_typicality"].concat(s.sonic_attrs).concat(l),u=function(){function e(){i(this,e)}return r(e,[{key:"getAttrs",value:function(e){var t=[],n=!0,i=!1,r=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,l=this[s];t.push(l)}}catch(e){i=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw r}}return t}},{key:"sonic_vector",value:function(){return this.getAttrs(s.sonic_attrs)}},{key:"similarity",value:function(e){var t=this.sonic_vector(),n=e.sonic_vector();return(0,a.default)(t,n)}},{key:"decade",get:function(){return this.year-this.year%10}},{key:"dedupe_key",get:function(){return this.track}}],[{key:"fromRow",value:function(t){var n=new e;n.year=+t.Year;var i=!0,r=!1,o=void 0;try{for(var a,s=c[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var l=a.value;n[l]=+t[l]}}catch(e){r=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}return n.artist=t.artist,n.track=t.track,n}}]),e}();t.Song=u},function(e,t,n){var i,r;/*!
 * ScrollMagic v2.0.5 (2015-04-29)
 * The javascript library for magical scroll interactions.
 * (c) 2015 Jan Paepke (@janpaepke)
 * Project Website: http://scrollmagic.io
 * 
 * @version 2.0.5
 * @license Dual licensed under MIT license and GPL.
 * @author Jan Paepke - e-mail@janpaepke.de
 *
 * @file ScrollMagic main library.
 */
!function(o,a){i=a,void 0!==(r="function"==typeof i?i.call(t,n,t,e):i)&&(e.exports=r)}(0,function(){"use strict";var e=function(){i.log(2,"(COMPATIBILITY NOTICE) -> As of ScrollMagic 2.0.0 you need to use 'new ScrollMagic.Controller()' to create a new controller instance. Use 'new ScrollMagic.Scene()' to instance a scene.")};e.version="2.0.5",window.addEventListener("mousewheel",function(){});e.Controller=function(n){var r,o,a="ScrollMagic.Controller",s=t.defaults,l=this,c=i.extend({},s,n),u=[],d=!1,h=0,f="PAUSED",g=!0,p=0,v=!0,y=function(){c.refreshInterval>0&&(o=window.setTimeout(x,c.refreshInterval))},m=function(){return c.vertical?i.get.scrollTop(c.container):i.get.scrollLeft(c.container)},b=function(){return c.vertical?i.get.height(c.container):i.get.width(c.container)},w=this._setScrollPos=function(e){c.vertical?g?window.scrollTo(i.get.scrollLeft(),e):c.container.scrollTop=e:g?window.scrollTo(e,i.get.scrollTop()):c.container.scrollLeft=e},S=function(){if(v&&d){var e=i.type.Array(d)?d:u.slice(0);d=!1;var t=h;h=l.scrollPos();var n=h-t;0!==n&&(f=n>0?"FORWARD":"REVERSE"),"REVERSE"===f&&e.reverse(),e.forEach(function(t,n){E(3,"updating Scene "+(n+1)+"/"+e.length+" ("+u.length+" total)"),t.update(!0)}),0===e.length&&c.loglevel>=3&&E(3,"updating 0 Scenes (nothing added to controller)")}},k=function(){r=i.rAF(S)},_=function(e){E(3,"event fired causing an update:",e.type),"resize"==e.type&&(p=b(),f="PAUSED"),!0!==d&&(d=!0,k())},x=function(){if(!g&&p!=b()){var e;try{e=new Event("resize",{bubbles:!1,cancelable:!1})}catch(t){e=document.createEvent("Event"),e.initEvent("resize",!1,!1)}c.container.dispatchEvent(e)}u.forEach(function(e,t){e.refresh()}),y()},E=this._log=function(e,t){c.loglevel>=e&&(Array.prototype.splice.call(arguments,1,0,"("+a+") ->"),i.log.apply(window,arguments))};this._options=c;var R=function(e){if(e.length<=1)return e;var t=e.slice(0);return t.sort(function(e,t){return e.scrollOffset()>t.scrollOffset()?1:-1}),t};return this.addScene=function(t){if(i.type.Array(t))t.forEach(function(e,t){l.addScene(e)});else if(t instanceof e.Scene){if(t.controller()!==l)t.addTo(l);else if(u.indexOf(t)<0){u.push(t),u=R(u),t.on("shift.controller_sort",function(){u=R(u)});for(var n in c.globalSceneOptions)t[n]&&t[n].call(t,c.globalSceneOptions[n]);E(3,"adding Scene (now "+u.length+" total)")}}else E(1,"ERROR: invalid argument supplied for '.addScene()'");return l},this.removeScene=function(e){if(i.type.Array(e))e.forEach(function(e,t){l.removeScene(e)});else{var t=u.indexOf(e);t>-1&&(e.off("shift.controller_sort"),u.splice(t,1),E(3,"removing Scene (now "+u.length+" left)"),e.remove())}return l},this.updateScene=function(t,n){return i.type.Array(t)?t.forEach(function(e,t){l.updateScene(e,n)}):n?t.update(!0):!0!==d&&t instanceof e.Scene&&(d=d||[],-1==d.indexOf(t)&&d.push(t),d=R(d),k()),l},this.update=function(e){return _({type:"resize"}),e&&S(),l},this.scrollTo=function(t,n){if(i.type.Number(t))w.call(c.container,t,n);else if(t instanceof e.Scene)t.controller()===l?l.scrollTo(t.scrollOffset(),n):E(2,"scrollTo(): The supplied scene does not belong to this controller. Scroll cancelled.",t);else if(i.type.Function(t))w=t;else{var r=i.get.elements(t)[0];if(r){for(;r.parentNode.hasAttribute("data-scrollmagic-pin-spacer");)r=r.parentNode;var o=c.vertical?"top":"left",a=i.get.offset(c.container),s=i.get.offset(r);g||(a[o]-=l.scrollPos()),l.scrollTo(s[o]-a[o],n)}else E(2,"scrollTo(): The supplied argument is invalid. Scroll cancelled.",t)}return l},this.scrollPos=function(e){return arguments.length?(i.type.Function(e)?m=e:E(2,"Provided value for method 'scrollPos' is not a function. To change the current scroll position use 'scrollTo()'."),l):m.call(l)},this.info=function(e){var t={size:p,vertical:c.vertical,scrollPos:h,scrollDirection:f,container:c.container,isDocument:g};return arguments.length?void 0!==t[e]?t[e]:void E(1,'ERROR: option "'+e+'" is not available'):t},this.loglevel=function(e){return arguments.length?(c.loglevel!=e&&(c.loglevel=e),l):c.loglevel},this.enabled=function(e){return arguments.length?(v!=e&&(v=!!e,l.updateScene(u,!0)),l):v},this.destroy=function(e){window.clearTimeout(o);for(var t=u.length;t--;)u[t].destroy(e);return c.container.removeEventListener("resize",_),c.container.removeEventListener("scroll",_),i.cAF(r),E(3,"destroyed "+a+" (reset: "+(e?"true":"false")+")"),null},function(){for(var t in c)s.hasOwnProperty(t)||(E(2,'WARNING: Unknown option "'+t+'"'),delete c[t]);if(c.container=i.get.elements(c.container)[0],!c.container)throw E(1,"ERROR creating object "+a+": No valid scroll container supplied"),a+" init failed.";g=c.container===window||c.container===document.body||!document.body.contains(c.container),g&&(c.container=window),p=b(),c.container.addEventListener("resize",_),c.container.addEventListener("scroll",_),c.refreshInterval=parseInt(c.refreshInterval)||s.refreshInterval,y(),E(3,"added new "+a+" controller (v"+e.version+")")}(),l};var t={defaults:{container:window,vertical:!0,globalSceneOptions:{},loglevel:2,refreshInterval:100}};e.Controller.addOption=function(e,n){t.defaults[e]=n},e.Controller.extend=function(t){var n=this;e.Controller=function(){return n.apply(this,arguments),this.$super=i.extend({},this),t.apply(this,arguments)||this},i.extend(e.Controller,n),e.Controller.prototype=n.prototype,e.Controller.prototype.constructor=e.Controller},e.Scene=function(t){var r,o,a="ScrollMagic.Scene",s=n.defaults,l=this,c=i.extend({},s,t),u="BEFORE",d=0,h={start:0,end:0},f=0,g=!0,p={};this.on=function(e,t){return i.type.Function(t)?(e=e.trim().split(" "),e.forEach(function(e){var n=e.split("."),i=n[0],r=n[1];"*"!=i&&(p[i]||(p[i]=[]),p[i].push({namespace:r||"",callback:t}))})):v(1,"ERROR when calling '.on()': Supplied callback for '"+e+"' is not a valid function!"),l},this.off=function(e,t){return e?(e=e.trim().split(" "),e.forEach(function(e,n){var i=e.split("."),r=i[0],o=i[1]||"";("*"===r?Object.keys(p):[r]).forEach(function(e){for(var n=p[e]||[],i=n.length;i--;){var r=n[i];!r||o!==r.namespace&&"*"!==o||t&&t!=r.callback||n.splice(i,1)}n.length||delete p[e]})}),l):(v(1,"ERROR: Invalid event name supplied."),l)},this.trigger=function(t,n){if(t){var i=t.trim().split("."),r=i[0],o=i[1],a=p[r];v(3,"event fired:",r,n?"->":"",n||""),a&&a.forEach(function(t,i){o&&o!==t.namespace||t.callback.call(l,new e.Event(r,t.namespace,l,n))})}else v(1,"ERROR: Invalid event name supplied.");return l},l.on("change.internal",function(e){"loglevel"!==e.what&&"tweenChanges"!==e.what&&("triggerElement"===e.what?b():"reverse"===e.what&&l.update())}).on("shift.internal",function(e){y(),l.update()});var v=this._log=function(e,t){c.loglevel>=e&&(Array.prototype.splice.call(arguments,1,0,"("+a+") ->"),i.log.apply(window,arguments))};this.addTo=function(t){return t instanceof e.Controller?o!=t&&(o&&o.removeScene(l),o=t,k(),m(!0),b(!0),y(),o.info("container").addEventListener("resize",w),t.addScene(l),l.trigger("add",{controller:o}),v(3,"added "+a+" to controller"),l.update()):v(1,"ERROR: supplied argument of 'addTo()' is not a valid ScrollMagic Controller"),l},this.enabled=function(e){return arguments.length?(g!=e&&(g=!!e,l.update(!0)),l):g},this.remove=function(){if(o){o.info("container").removeEventListener("resize",w);var e=o;o=void 0,e.removeScene(l),l.trigger("remove"),v(3,"removed "+a+" from controller")}return l},this.destroy=function(e){return l.trigger("destroy",{reset:e}),l.remove(),l.off("*.*"),v(3,"destroyed "+a+" (reset: "+(e?"true":"false")+")"),null},this.update=function(e){if(o)if(e)if(o.enabled()&&g){var t,n=o.info("scrollPos");t=c.duration>0?(n-h.start)/(h.end-h.start):n>=h.start?1:0,l.trigger("update",{startPos:h.start,endPos:h.end,scrollPos:n}),l.progress(t)}else E&&"DURING"===u&&O(!0);else o.updateScene(l,!1);return l},this.refresh=function(){return m(),b(),l},this.progress=function(e){if(arguments.length){var t=!1,n=u,i=o?o.info("scrollDirection"):"PAUSED",r=c.reverse||e>=d;if(0===c.duration?(t=d!=e,d=e<1&&r?0:1,u=0===d?"BEFORE":"DURING"):e<0&&"BEFORE"!==u&&r?(d=0,u="BEFORE",t=!0):e>=0&&e<1&&r?(d=e,u="DURING",t=!0):e>=1&&"AFTER"!==u?(d=1,u="AFTER",t=!0):"DURING"!==u||r||O(),t){var a={progress:d,state:u,scrollDirection:i},s=u!=n,h=function(e){l.trigger(e,a)};s&&"DURING"!==n&&(h("enter"),h("BEFORE"===n?"start":"end")),h("progress"),s&&"DURING"!==u&&(h("BEFORE"===u?"start":"end"),h("leave"))}return l}return d};var y=function(){h={start:f+c.offset},o&&c.triggerElement&&(h.start-=o.info("size")*c.triggerHook),h.end=h.start+c.duration},m=function(e){if(r){_("duration",r.call(l))&&!e&&(l.trigger("change",{what:"duration",newval:c.duration}),l.trigger("shift",{reason:"duration"}))}},b=function(e){var t=0,n=c.triggerElement;if(o&&n){for(var r=o.info(),a=i.get.offset(r.container),s=r.vertical?"top":"left";n.parentNode.hasAttribute("data-scrollmagic-pin-spacer");)n=n.parentNode;var u=i.get.offset(n);r.isDocument||(a[s]-=o.scrollPos()),t=u[s]-a[s]}var d=t!=f;f=t,d&&!e&&l.trigger("shift",{reason:"triggerElementPosition"})},w=function(e){c.triggerHook>0&&l.trigger("shift",{reason:"containerResize"})},S=i.extend(n.validate,{duration:function(e){if(i.type.String(e)&&e.match(/^(\.|\d)*\d+%$/)){var t=parseFloat(e)/100;e=function(){return o?o.info("size")*t:0}}if(i.type.Function(e)){r=e;try{e=parseFloat(r())}catch(t){e=-1}}if(e=parseFloat(e),!i.type.Number(e)||e<0)throw r?(r=void 0,['Invalid return value of supplied function for option "duration":',e]):['Invalid value for option "duration":',e];return e}}),k=function(e){e=arguments.length?[e]:Object.keys(S),e.forEach(function(e,t){var n;if(S[e])try{n=S[e](c[e])}catch(t){n=s[e];var r=i.type.String(t)?[t]:t;i.type.Array(r)?(r[0]="ERROR: "+r[0],r.unshift(1),v.apply(this,r)):v(1,"ERROR: Problem executing validation callback for option '"+e+"':",t.message)}finally{c[e]=n}})},_=function(e,t){var n=!1,i=c[e];return c[e]!=t&&(c[e]=t,k(e),n=i!=c[e]),n},x=function(e){l[e]||(l[e]=function(t){return arguments.length?("duration"===e&&(r=void 0),_(e,t)&&(l.trigger("change",{what:e,newval:c[e]}),n.shifts.indexOf(e)>-1&&l.trigger("shift",{reason:e})),l):c[e]})};this.controller=function(){return o},this.state=function(){return u},this.scrollOffset=function(){return h.start},this.triggerPosition=function(){var e=c.offset;return o&&(c.triggerElement?e+=f:e+=o.info("size")*l.triggerHook()),e};var E,R;l.on("shift.internal",function(e){var t="duration"===e.reason;("AFTER"===u&&t||"DURING"===u&&0===c.duration)&&O(),t&&P()}).on("progress.internal",function(e){O()}).on("add.internal",function(e){P()}).on("destroy.internal",function(e){l.removePin(e.reset)});var O=function(e){if(E&&o){var t=o.info(),n=R.spacer.firstChild;if(e||"DURING"!==u){var r={position:R.inFlow?"relative":"absolute",top:0,left:0},a=i.css(n,"position")!=r.position;R.pushFollowers?c.duration>0&&("AFTER"===u&&0===parseFloat(i.css(R.spacer,"padding-top"))?a=!0:"BEFORE"===u&&0===parseFloat(i.css(R.spacer,"padding-bottom"))&&(a=!0)):r[t.vertical?"top":"left"]=c.duration*d,i.css(n,r),a&&P()}else{"fixed"!=i.css(n,"position")&&(i.css(n,{position:"fixed"}),P());var s=i.get.offset(R.spacer,!0),l=c.reverse||0===c.duration?t.scrollPos-h.start:Math.round(d*c.duration*10)/10;s[t.vertical?"top":"left"]+=l,i.css(R.spacer.firstChild,{top:s.top,left:s.left})}}},P=function(){if(E&&o&&R.inFlow){var e="DURING"===u,t=o.info("vertical"),n=R.spacer.firstChild,r=i.isMarginCollapseType(i.css(R.spacer,"display")),a={};R.relSize.width||R.relSize.autoFullWidth?e?i.css(E,{width:i.get.width(R.spacer)}):i.css(E,{width:"100%"}):(a["min-width"]=i.get.width(t?E:n,!0,!0),a.width=e?a["min-width"]:"auto"),R.relSize.height?e?i.css(E,{height:i.get.height(R.spacer)-(R.pushFollowers?c.duration:0)}):i.css(E,{height:"100%"}):(a["min-height"]=i.get.height(t?n:E,!0,!r),a.height=e?a["min-height"]:"auto"),R.pushFollowers&&(a["padding"+(t?"Top":"Left")]=c.duration*d,a["padding"+(t?"Bottom":"Right")]=c.duration*(1-d)),i.css(R.spacer,a)}},T=function(){o&&E&&"DURING"===u&&!o.info("isDocument")&&O()},A=function(){o&&E&&"DURING"===u&&((R.relSize.width||R.relSize.autoFullWidth)&&i.get.width(window)!=i.get.width(R.spacer.parentNode)||R.relSize.height&&i.get.height(window)!=i.get.height(R.spacer.parentNode))&&P()},C=function(e){o&&E&&"DURING"===u&&!o.info("isDocument")&&(e.preventDefault(),o._setScrollPos(o.info("scrollPos")-((e.wheelDelta||e[o.info("vertical")?"wheelDeltaY":"wheelDeltaX"])/3||30*-e.detail)))};this.setPin=function(e,t){var n={pushFollowers:!0,spacerClass:"scrollmagic-pin-spacer"};if(t=i.extend({},n,t),!(e=i.get.elements(e)[0]))return v(1,"ERROR calling method 'setPin()': Invalid pin element supplied."),l;if("fixed"===i.css(e,"position"))return v(1,"ERROR calling method 'setPin()': Pin does not work with elements that are positioned 'fixed'."),l;if(E){if(E===e)return l;l.removePin()}E=e;var r=E.parentNode.style.display,o=["top","left","bottom","right","margin","marginLeft","marginRight","marginTop","marginBottom"];E.parentNode.style.display="none";var a="absolute"!=i.css(E,"position"),s=i.css(E,o.concat(["display"])),u=i.css(E,["width","height"]);E.parentNode.style.display=r,!a&&t.pushFollowers&&(v(2,"WARNING: If the pinned element is positioned absolutely pushFollowers will be disabled."),t.pushFollowers=!1),window.setTimeout(function(){E&&0===c.duration&&t.pushFollowers&&v(2,"WARNING: pushFollowers =",!0,"has no effect, when scene duration is 0.")},0);var d=E.parentNode.insertBefore(document.createElement("div"),E),h=i.extend(s,{position:a?"relative":"absolute",boxSizing:"content-box",mozBoxSizing:"content-box",webkitBoxSizing:"content-box"});if(a||i.extend(h,i.css(E,["width","height"])),i.css(d,h),d.setAttribute("data-scrollmagic-pin-spacer",""),i.addClass(d,t.spacerClass),R={spacer:d,relSize:{width:"%"===u.width.slice(-1),height:"%"===u.height.slice(-1),autoFullWidth:"auto"===u.width&&a&&i.isMarginCollapseType(s.display)},pushFollowers:t.pushFollowers,inFlow:a},!E.___origStyle){E.___origStyle={};var f=E.style;o.concat(["width","height","position","boxSizing","mozBoxSizing","webkitBoxSizing"]).forEach(function(e){E.___origStyle[e]=f[e]||""})}return R.relSize.width&&i.css(d,{width:u.width}),R.relSize.height&&i.css(d,{height:u.height}),d.appendChild(E),i.css(E,{position:a?"relative":"absolute",margin:"auto",top:"auto",left:"auto",bottom:"auto",right:"auto"}),(R.relSize.width||R.relSize.autoFullWidth)&&i.css(E,{boxSizing:"border-box",mozBoxSizing:"border-box",webkitBoxSizing:"border-box"}),window.addEventListener("scroll",T),window.addEventListener("resize",T),window.addEventListener("resize",A),E.addEventListener("mousewheel",C),E.addEventListener("DOMMouseScroll",C),v(3,"added pin"),O(),l},this.removePin=function(e){if(E){if("DURING"===u&&O(!0),e||!o){var t=R.spacer.firstChild;if(t.hasAttribute("data-scrollmagic-pin-spacer")){var n=R.spacer.style,r=["margin","marginLeft","marginRight","marginTop","marginBottom"];margins={},r.forEach(function(e){margins[e]=n[e]||""}),i.css(t,margins)}R.spacer.parentNode.insertBefore(t,R.spacer),R.spacer.parentNode.removeChild(R.spacer),E.parentNode.hasAttribute("data-scrollmagic-pin-spacer")||(i.css(E,E.___origStyle),delete E.___origStyle)}window.removeEventListener("scroll",T),window.removeEventListener("resize",T),window.removeEventListener("resize",A),E.removeEventListener("mousewheel",C),E.removeEventListener("DOMMouseScroll",C),E=void 0,v(3,"removed pin (reset: "+(e?"true":"false")+")")}return l};var M,F=[];return l.on("destroy.internal",function(e){l.removeClassToggle(e.reset)}),this.setClassToggle=function(e,t){var n=i.get.elements(e);return 0!==n.length&&i.type.String(t)?(F.length>0&&l.removeClassToggle(),M=t,F=n,l.on("enter.internal_class leave.internal_class",function(e){var t="enter"===e.type?i.addClass:i.removeClass;F.forEach(function(e,n){t(e,M)})}),l):(v(1,"ERROR calling method 'setClassToggle()': Invalid "+(0===n.length?"element":"classes")+" supplied."),l)},this.removeClassToggle=function(e){return e&&F.forEach(function(e,t){i.removeClass(e,M)}),l.off("start.internal_class end.internal_class"),M=void 0,F=[],l},function(){for(var e in c)s.hasOwnProperty(e)||(v(2,'WARNING: Unknown option "'+e+'"'),delete c[e]);for(var t in s)x(t);k()}(),l};var n={defaults:{duration:0,offset:0,triggerElement:void 0,triggerHook:.5,reverse:!0,loglevel:2},validate:{offset:function(e){if(e=parseFloat(e),!i.type.Number(e))throw['Invalid value for option "offset":',e];return e},triggerElement:function(e){if(e=e||void 0){var t=i.get.elements(e)[0];if(!t)throw['Element defined in option "triggerElement" was not found:',e];e=t}return e},triggerHook:function(e){var t={onCenter:.5,onEnter:1,onLeave:0};if(i.type.Number(e))e=Math.max(0,Math.min(parseFloat(e),1));else{if(!(e in t))throw['Invalid value for option "triggerHook": ',e];e=t[e]}return e},reverse:function(e){return!!e},loglevel:function(e){if(e=parseInt(e),!i.type.Number(e)||e<0||e>3)throw['Invalid value for option "loglevel":',e];return e}},shifts:["duration","offset","triggerHook"]};e.Scene.addOption=function(t,i,r,o){t in n.defaults?e._util.log(1,"[static] ScrollMagic.Scene -> Cannot add Scene option '"+t+"', because it already exists."):(n.defaults[t]=i,n.validate[t]=r,o&&n.shifts.push(t))},e.Scene.extend=function(t){var n=this;e.Scene=function(){return n.apply(this,arguments),this.$super=i.extend({},this),t.apply(this,arguments)||this},i.extend(e.Scene,n),e.Scene.prototype=n.prototype,e.Scene.prototype.constructor=e.Scene},e.Event=function(e,t,n,i){i=i||{};for(var r in i)this[r]=i[r];return this.type=e,this.target=this.currentTarget=n,this.namespace=t||"",this.timeStamp=this.timestamp=Date.now(),this};var i=e._util=function(e){var t,n={},i=function(e){return parseFloat(e)||0},r=function(t){return t.currentStyle?t.currentStyle:e.getComputedStyle(t)},o=function(t,n,o,a){if((n=n===document?e:n)===e)a=!1;else if(!g.DomElement(n))return 0;t=t.charAt(0).toUpperCase()+t.substr(1).toLowerCase();var s=(o?n["offset"+t]||n["outer"+t]:n["client"+t]||n["inner"+t])||0;if(o&&a){var l=r(n);s+="Height"===t?i(l.marginTop)+i(l.marginBottom):i(l.marginLeft)+i(l.marginRight)}return s},a=function(e){return e.replace(/^[^a-z]+([a-z])/g,"$1").replace(/-([a-z])/g,function(e){return e[1].toUpperCase()})};n.extend=function(e){for(e=e||{},t=1;t<arguments.length;t++)if(arguments[t])for(var n in arguments[t])arguments[t].hasOwnProperty(n)&&(e[n]=arguments[t][n]);return e},n.isMarginCollapseType=function(e){return["block","flex","list-item","table","-webkit-box"].indexOf(e)>-1};var s=0,l=["ms","moz","webkit","o"],c=e.requestAnimationFrame,u=e.cancelAnimationFrame;for(t=0;!c&&t<l.length;++t)c=e[l[t]+"RequestAnimationFrame"],u=e[l[t]+"CancelAnimationFrame"]||e[l[t]+"CancelRequestAnimationFrame"];c||(c=function(t){var n=(new Date).getTime(),i=Math.max(0,16-(n-s)),r=e.setTimeout(function(){t(n+i)},i);return s=n+i,r}),u||(u=function(t){e.clearTimeout(t)}),n.rAF=c.bind(e),n.cAF=u.bind(e);var d=["error","warn","log"],h=e.console||{};for(h.log=h.log||function(){},t=0;t<d.length;t++){var f=d[t];h[f]||(h[f]=h.log)}n.log=function(e){(e>d.length||e<=0)&&(e=d.length);var t=new Date,n=("0"+t.getHours()).slice(-2)+":"+("0"+t.getMinutes()).slice(-2)+":"+("0"+t.getSeconds()).slice(-2)+":"+("00"+t.getMilliseconds()).slice(-3),i=d[e-1],r=Array.prototype.splice.call(arguments,1),o=Function.prototype.bind.call(h[i],h);r.unshift(n),o.apply(h,r)};var g=n.type=function(e){return Object.prototype.toString.call(e).replace(/^\[object (.+)\]$/,"$1").toLowerCase()};g.String=function(e){return"string"===g(e)},g.Function=function(e){return"function"===g(e)},g.Array=function(e){return Array.isArray(e)},g.Number=function(e){return!g.Array(e)&&e-parseFloat(e)+1>=0},g.DomElement=function(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName};var p=n.get={};return p.elements=function(t){var n=[];if(g.String(t))try{t=document.querySelectorAll(t)}catch(e){return n}if("nodelist"===g(t)||g.Array(t))for(var i=0,r=n.length=t.length;i<r;i++){var o=t[i];n[i]=g.DomElement(o)?o:p.elements(o)}else(g.DomElement(t)||t===document||t===e)&&(n=[t]);return n},p.scrollTop=function(t){return t&&"number"==typeof t.scrollTop?t.scrollTop:e.pageYOffset||0},p.scrollLeft=function(t){return t&&"number"==typeof t.scrollLeft?t.scrollLeft:e.pageXOffset||0},p.width=function(e,t,n){return o("width",e,t,n)},p.height=function(e,t,n){return o("height",e,t,n)},p.offset=function(e,t){var n={top:0,left:0};if(e&&e.getBoundingClientRect){var i=e.getBoundingClientRect();n.top=i.top,n.left=i.left,t||(n.top+=p.scrollTop(),n.left+=p.scrollLeft())}return n},n.addClass=function(e,t){t&&(e.classList?e.classList.add(t):e.className+=" "+t)},n.removeClass=function(e,t){t&&(e.classList?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi")," "))},n.css=function(e,t){if(g.String(t))return r(e)[a(t)];if(g.Array(t)){var n={},i=r(e);return t.forEach(function(e,t){n[e]=i[a(e)]}),n}for(var o in t){var s=t[o];s==parseFloat(s)&&(s+="px"),e.style[a(o)]=s}},n}(window||{});return e.Scene.prototype.addIndicators=function(){return e._util.log(1,"(ScrollMagic.Scene) -> ERROR calling addIndicators() due to missing Plugin 'debug.addIndicators'. Please make sure to include plugins/debug.addIndicators.js"),this},e.Scene.prototype.removeIndicators=function(){return e._util.log(1,"(ScrollMagic.Scene) -> ERROR calling removeIndicators() due to missing Plugin 'debug.addIndicators'. Please make sure to include plugins/debug.addIndicators.js"),this},e.Scene.prototype.setTween=function(){return e._util.log(1,"(ScrollMagic.Scene) -> ERROR calling setTween() due to missing Plugin 'animation.gsap'. Please make sure to include plugins/animation.gsap.js"),this},e.Scene.prototype.removeTween=function(){return e._util.log(1,"(ScrollMagic.Scene) -> ERROR calling removeTween() due to missing Plugin 'animation.gsap'. Please make sure to include plugins/animation.gsap.js"),this},e.Scene.prototype.setVelocity=function(){return e._util.log(1,"(ScrollMagic.Scene) -> ERROR calling setVelocity() due to missing Plugin 'animation.velocity'. Please make sure to include plugins/animation.velocity.js"),this},e.Scene.prototype.removeVelocity=function(){return e._util.log(1,"(ScrollMagic.Scene) -> ERROR calling removeVelocity() due to missing Plugin 'animation.velocity'. Please make sure to include plugins/animation.velocity.js"),this},e})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),r=function(e){return e&&e.__esModule?e:{default:e}}(i),o=new r.default.Controller;t.default=o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(){var e=f.node().offsetWidth;g!==e&&(g=e,u.default.resize())}var o=n(9),a=i(o),s=n(11),l=i(s),c=n(12),u=i(c),d=n(1),h=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(d),f=d3.select("body"),g=0;!function(){f.classed("is-mobile",l.default.any()),window.addEventListener("resize",(0,a.default)(r,150)),h.load().then(function(){return u.default.init()})}()},function(e,t,n){(function(t){function n(e,t,n){function r(t){var n=p,i=v;return p=v=void 0,x=t,m=e.apply(i,n)}function o(e){return x=e,b=setTimeout(u,t),E?r(e):m}function l(e){var n=e-_,i=e-x,r=t-n;return R?S(r,y-i):r}function c(e){var n=e-_,i=e-x;return void 0===_||n>=t||n<0||R&&i>=y}function u(){var e=k();if(c(e))return d(e);b=setTimeout(u,l(e))}function d(e){return b=void 0,O&&p?r(e):(p=v=void 0,m)}function h(){void 0!==b&&clearTimeout(b),x=0,p=_=v=b=void 0}function f(){return void 0===b?m:d(k())}function g(){var e=k(),n=c(e);if(p=arguments,v=this,_=e,n){if(void 0===b)return o(_);if(R)return b=setTimeout(u,t),r(_)}return void 0===b&&(b=setTimeout(u,t)),m}var p,v,y,m,b,_,x=0,E=!1,R=!1,O=!0;if("function"!=typeof e)throw new TypeError(s);return t=a(t)||0,i(n)&&(E=!!n.leading,R="maxWait"in n,y=R?w(a(n.maxWait)||0,t):y,O="trailing"in n?!!n.trailing:O),g.cancel=h,g.flush=f,g}function i(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function r(e){return!!e&&"object"==typeof e}function o(e){return"symbol"==typeof e||r(e)&&b.call(e)==c}function a(e){if("number"==typeof e)return e;if(o(e))return l;if(i(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=i(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(u,"");var n=h.test(e);return n||f.test(e)?g(e.slice(2),n?2:8):d.test(e)?l:+e}var s="Expected a function",l=NaN,c="[object Symbol]",u=/^\s+|\s+$/g,d=/^[-+]0x[0-9a-f]+$/i,h=/^0b[01]+$/i,f=/^0o[0-7]+$/i,g=parseInt,p="object"==typeof t&&t&&t.Object===Object&&t,v="object"==typeof self&&self&&self.Object===Object&&self,y=p||v||Function("return this")(),m=Object.prototype,b=m.toString,w=Math.max,S=Math.min,k=function(){return y.Date.now()};e.exports=n}).call(t,n(10))},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={android:function(){return navigator.userAgent.match(/Android/i)},blackberry:function(){return navigator.userAgent.match(/BlackBerry/i)},ios:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},opera:function(){return navigator.userAgent.match(/Opera Mini/i)},windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return i.android()||i.blackberry()||i.ios()||i.opera()||i.windows()}};t.default=i},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(){console.log("got a resize"),this.explorer.onResize()}function o(){this.explorer=s.default.init(),l.StoryTeller.init(),window.onbeforeunload=function(){window.scrollTo(0,0)}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(13),s=i(a),l=n(18),c=n(7),u=(i(c),{});r=r.bind(u),o=o.bind(u),t.default={init:o,resize:r}},function(e,t,n){"use strict";function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){for(var t=[],n=0;n<10;n++){var i=e+n;i>=h&&i<=f&&t.push(e+n)}return t}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=(n(2),n(14)),l=(n(5),n(0)),c=i(l),u=n(1),d=i(u),h=c.year_range[0],f=c.year_range[1],g=[1950,1960,1970,1980,1990,2e3,2010],p=function(){function e(){r(this,e),this.songdat=d.db;this.root=d3.select("#song-explorer"),this.margin={top:20,right:20,bottom:50,left:20};var t=this.songdat[50];this.decade=t.decade,this.year=t.year,this.setupControls(),this.songView=this.root.append("div").classed("song-view",!0),this.songChart=new s.SongChart(this.songView),this.moreSongs=this.root.append("div");var n=this.moreSongs.append("div").classed("moreby",!0).classed("picker",!0).style("display","none");n.append("span").classed("label",!0),n.append("span").classed("songs",!0),this.moreby=n;var i=this.moreSongs.append("div").classed("simsongs",!0).classed("picker",!0);i.append("span").classed("label",!0).text("Similar songs: "),i.append("span").classed("songs",!0);var o=this.moreSongs.append("div").classed("simsongs-future",!0).classed("picker",!0);o.append("span").classed("label",!0).text("Similar songs (future): "),o.append("span").classed("songs",!0),this.selectSong(t)}return a(e,[{key:"onResize",value:function(){this.songChart.onResize()}},{key:"setupControls",value:function(){var e=this,t=this.root.append("div").classed("picker",!0);t.append("div").classed("decade-picker",!0).selectAll(".decade-selector").data(g).enter().append("a").classed("decade-selector",!0).classed("active",function(t){return t==e.decade}).text(function(e){return e+"s"}).on("click",function(t){return e.setDecade(t)}),this.year_picker=t.append("div").classed("year-picker",!0),this.updateYears(),this.song_picker=t.append("div").classed("song-picker",!0),this.updateSongs()}},{key:"setDecade",value:function(e){var t=this;e!=this.decade&&(this.decade=e,this.root.selectAll(".decade-selector").classed("active",function(e){return e==t.decade}),this.year=Math.min(f,Math.max(h,this.decade)),this.updateYears(),this.updateSongs())}},{key:"updateYears",value:function(){var e=this,t=o(this.decade),n=this.year_picker.selectAll(".year-selector").data(t);n.exit().remove();var i=n.enter().append("a").classed("year-selector",!0);n.merge(i).text(function(e){return e}).on("click",function(t){return e.setYear(t)}).classed("active",function(t){return t==e.year})}},{key:"setYear",value:function(e){var t=this;console.debug("Setting year to ",e),this.year=e,this.year_picker.selectAll(".year-selector").classed("active",function(e){return e==t.year}),this.updateSongs()}},{key:"updateSongs",value:function(){var e=this,t=this.songdat.filter(function(t){return t.year==e.year});t.sort(function(e,t){return d3.ascending(e.track,t.track)});var n=this.song_picker.selectAll(".song-selector").data(t,function(e){return e.track});n.exit().remove();var i=n.enter().append("a").classed("song-selector",!0);n.merge(i).text(function(e){return e.track}).attr("title",function(e){return 100*e.typicality.toPrecision(2)+"% typical"}).style("color",function(e){return c.typicality_cmap(e.typicality)}).on("click",function(t){return e.selectSong(t)}).on("mouseover",function(t){return e.contrastSong(t)}).on("mouseout",function(t){return e.decontrastSong()}).on("contextmenu",function(t){return e.songChart.setSticky()}).classed("active",function(t){return t==e.song})}},{key:"populateSongs",value:function(e,t){var n=this,i=e.selectAll(".song-selector").data(t);i.exit().remove();var r=i.enter().append("a").classed("song-selector",!0);i.merge(r).text(function(e){return e.track}).style("color",function(e){return c.typicality_cmap(e.typicality)}).on("click",function(e){return n.selectSong(e)}).on("mouseover",function(e){return n.contrastSong(e)}).on("mouseout",function(e){return n.decontrastSong()}).on("contextmenu",function(e){return n.songChart.setSticky()}).classed("active",function(e){return e==n.song})}},{key:"selectSong",value:function(e){var t=this;console.debug("Setting song to "+e.track),this.song=e,this.song_picker.selectAll(".song-selector").classed("active",function(e){return e==t.song}),this.songChart.setSong(this.song),this.updateMoreSongs()}},{key:"updateMoreSongs",value:function(){var e=this,t=this.songdat.filter(function(t){return t.artist==e.song.artist&&t.track!=e.song.track});0==t.length?this.moreby.style("display","none"):(this.moreby.style("display","initial"),this.moreby.select(".label").text("More by "+this.song.artist+": "),this.populateSongs(this.moreby.select(".songs"),t));var n=this.songdat.filter(function(t){return e.song.year-t.year>=0&&e.song.year-t.year<8&&t.track!=e.song.track});n.sort(function(t,n){return d3.descending(e.song.similarity(t),e.song.similarity(n))}),n=n.slice(0,10),this.populateSongs(this.moreSongs.select(".simsongs .songs"),n),n=this.songdat.filter(function(t){return e.song.year-t.year<0&&e.song.year-t.year>-8&&t.track!=e.song.track}),n.sort(function(t,n){return d3.descending(e.song.similarity(t),e.song.similarity(n))}),n=n.slice(0,10),this.populateSongs(this.moreSongs.select(".simsongs-future .songs"),n)}},{key:"contrastSong",value:function(e){e!=this.song&&this.songChart.contrastSong(e)}},{key:"decontrastSong",value:function(){this.songChart.decontrastSong()}}],[{key:"init",value:function(){return new e}}]),e}();t.default=p},function(e,t,n){"use strict";function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.SongChart=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=n(2),l=n(0),c=i(l),u=n(1),d=i(u),h=function(){function e(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];r(this,e),this.root=t,this.name=t.attr("class"),this.show_year=i,this.heading=this.root.append("div").classed("heading",!0).classed("tk-atlas",!0).classed("prose__hed",!0);var a=this.heading.append("h3");o&&(a=a.append("mark")),a.classed("main",!0),this.heading.append("h4").classed("contrast",!0).style("color",c.contrast_color);var l=Math.min(this.root.node().offsetWidth,.8*window.innerHeight);l=Math.min(600,l),this.svg=this.root.append("svg").classed("radar",!0).attr("width",l).attr("height",l),this.radar=new s.RadarChart(this.svg),this.meta_tray=this.root.append("div").style("display","none"),this.debug=!1,this.root.on("dblclick",function(){return n.toggleDebug()})}return a(e,[{key:"toggleDebug",value:function(){console.log("toggling debug view"),this.debug=!this.debug,this.meta_tray.style("display",this.debug?"initial":"none")}},{key:"onResize",value:function(){}},{key:"setSong",value:function(e){if(this.decontrastSong(),this.contrast=void 0,this.sticky=!1,"string"==typeof e){if(this.song&&e==this.song.track)return;e=d.lookup(e)}e!=this.song&&(this.song=e,this.radar.setSong(this.song),this.song&&(this.updateHeading(),this.updateTray()))}},{key:"transitionSong",value:function(e){this.setSong(e)}},{key:"updateTray",value:function(){this.meta_tray.text("");var e=[["typicality","typicality_all","typicality_orig","typical_typicality_orig","typical_typicality"],c.sonic_attrs,["mode","raw_tempo","raw_key","raw_time_signature"]],t=!0,n=!1,i=void 0;try{for(var r,a=e[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var s=r.value,l=this.meta_tray.append("div"),u=!0,d=!1,h=void 0;try{for(var f,g=s[Symbol.iterator]();!(u=(f=g.next()).done);u=!0){var p=f.value,v=this.song[p];console.assert(void 0!=v,"No value found for "+p),console.assert("number"==typeof v,p+" has type "+(void 0===v?"undefined":o(v))+", not number");var y=p+": "+v.toPrecision(3);l.append("span").classed("meta_factoid",!0).text(y)}}catch(e){d=!0,h=e}finally{try{!u&&g.return&&g.return()}finally{if(d)throw h}}}}catch(e){n=!0,i=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw i}}}},{key:"updateHeading",value:function(){var e=this.song.artist+" - "+this.song.track+" ("+(100*this.song.typicality).toPrecision(3)+"% typical)";this.show_year&&(e=this.song.year+": "+e),this.heading.select(".main").text(e);var t=this.heading.select(".contrast");if(this.contrast){t.style("opacity",1);var n=100*this.song.similarity(this.contrast),i=" vs. "+this.contrast.artist+" - "+this.contrast.track+" ("+n.toPrecision(3)+"% similar)";t.text(i)}else t.text("|"),t.style("opacity",0)}},{key:"contrastSong",value:function(e){this.contrast,this.contrast=e,this.updateHeading(),this.radar.plotSong(e,"contrast")}},{key:"decontrastSong",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!this.contrast||this.sticky&&!e||(this.radar.decontrast(),this.contrast=void 0,this.updateHeading())}},{key:"setSticky",value:function(){this.sticky=!0}}]),e}();t.SongChart=h},function(e,t,n){"use strict";function i(e,t){return function(n,i){return e(n,i,t)}}function r(e,t,n){var r,c,u;if(!s(e))throw new TypeError("cosine-similarity()::invalid input argument. First argument must be an array. Value: `"+e+"`.");if(!s(t))throw new TypeError("cosine-similarity()::invalid input argument. Second argument must be an array. Value: `"+t+"`.");if(arguments.length>2&&!l(n))throw new TypeError("cosine-similarity()::invalid input argument. Accessor must be a function. Value: `"+n+"`.");if(e.length!==t.length)throw new Error("cosine-similarity()::invalid input argument. Input arrays must have the same length.");return e.length?(n?(r=o(e,t,n),c=a(e,i(n,0)),u=a(t,i(n,1))):(r=o(e,t),c=a(e),u=a(t)),r/(c*u)):null}var o=n(16),a=n(17),s=n(3),l=n(4);e.exports=r},function(e,t,n){"use strict";function i(e,t,n){if(!r(e))throw new TypeError("dot()::invalid input argument. First argument must be an array. Value: `"+e+"`.");if(!r(t))throw new TypeError("dot()::invalid input argument. Second argument must be an array. Value: `"+t+"`.");if(arguments.length>2&&!o(n))throw new TypeError("dot()::invalid input argument. Accessor must be a function. Value: `"+n+"`.");var i,a=e.length,s=0;if(a!==t.length)throw new Error("dot()::invalid input argument. Arrays must be of equal length.");if(!a)return null;if(n)for(i=0;i<a;i++)s+=n(e[i],i,0)*n(t[i],i,1);else for(i=0;i<a;i++)s+=e[i]*t[i];return s}var r=n(3),o=n(4);e.exports=i},function(e,t,n){"use strict";function i(e,t){if(!r(e))throw new TypeError("l2norm()::invalid input argument. Must provide an array.  Value: `"+e+"`.");if(arguments.length>1&&!o(t))throw new TypeError("l2norm()::invalid input argument. Accessor must be a function. Value: `"+t+"`.");var n,i,a,s,l=e.length,c=0,u=1;if(!l)return null;if(t)for(s=0;s<l;s++)i=t(e[s],s),(a=i<0?-i:i)>0&&(a>c?(n=c/i,u=1+u*n*n,c=a):(n=i/c,u+=n*n));else for(s=0;s<l;s++)i=e[s],(a=i<0?-i:i)>0&&(a>c?(n=c/i,u=1+u*n*n,c=a):(n=i/c,u+=n*n));return c*Math.sqrt(u)}var r=n(3),o=n(4);e.exports=i},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.StoryTeller=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(6),s=i(a),l=n(7),c=i(l),u=n(19),d=n(20),h=n(0),f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(h),g=function(){function e(){var t=this;r(this,e),this.controller=c.default;this.root=d3.select("#story");var n=this.root.select(".sticky");this.sticky=n,this.chart=new u.StickySongGraphic(n),this.setupSonicIntro();var i=window.innerHeight;new s.default.Scene({triggerElement:"#story",triggerHook:"onLeave",duration:Math.max(1,this.root.node().offsetHeight-i)}).on("enter",function(){console.debug("Pinning story div"),t.toggleFixed(!0,!1)}).on("leave",function(e){console.log("Unpinning story div"),t.toggleFixed(!1,"FORWARD"===e.scrollDirection)}).addTo(this.controller);this.setupScenes()}return o(e,[{key:"toggleFixed",value:function(e,t){this.sticky.classed("is-fixed",e),this.sticky.classed("is-bottom",t)}},{key:"setupSonicIntro",value:function(){for(var e=this.root.select("#sonicreveal"),t=void 0,n=0;n<f.sonic_attrs.length;n++){t=(n+6)%f.sonic_attrs.length;var i=f.sonic_attrs[t],r=e.append("div").classed("step",!0).attr("data-hide_avg","1").attr("data-highlight_sonics",i),o=d.attr_texts[i];r.selectAll("p").data(o).enter().append("p").html(function(e){return e})}}},{key:"setupScenes",value:function(){var e=this;this.root.selectAll(".step").datum(function(){return this.dataset}).each(function(t,n,i){e.addSceneForStep(t,i[n])})}},{key:"addSceneForStep",value:function(e,t){var n=this,i=d3.select(t);new s.default.Scene({triggerElement:t,triggerHook:"onCenter",duration:t.offsetHeight}).on("enter",function(t){i.classed("active",!0),n.enterCbForStepdat(e)(t)}).on("leave",function(e){i.classed("active",!1)}).on("leave",this.leaveCbForStepdat(e)).addTo(this.controller)}},{key:"enterCbForStepdat",value:function(e){var t=this;return function(n){if(e.song&&t.chart.transitionSong(e.song),e.highlight_sonics&&t.chart.setSonicHighlight(e.highlight_sonics),e.hide_avg||e.show_avg){var i=e.show_avg;t.chart.showAverage(i)}e.highlight_web&&t.chart.highlightWeb(e.highlight_web)}}},{key:"leaveCbForStepdat",value:function(e){var t=this;return function(n){e.highlight_web&&t.chart.clearWebHighlights(),e.highlight_sonics&&t.chart.radar.unsetSonicHighlights(e.highlight_sonics)}}}],[{key:"init",value:function(){return new e}}]),e}();t.StoryTeller=g},function(e,t,n){"use strict";function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.StickySongGraphic=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(2),s=n(0),l=i(s),c=n(1),u=i(c),d=function(){function e(t){r(this,e),this.root=t,this.name=t.attr("class"),this.song=void 0,this.heading=this.root.append("div").classed("heading",!0).classed("tk-atlas",!0).classed("prose__hed",!0),this.slider=new h(this.heading),this.heading.append("h3").classed("main",!0);var n=this.root.append("div").classed("chart",!0);this.svg=n.append("svg").classed("radar",!0),this.radar=new a.RadarChart(this.svg,n)}return o(e,[{key:"setSonicHighlight",value:function(e){this.radar.setSonicHighlights(e)}},{key:"showAverage",value:function(e){this.radar.getWebs("baseline").classed("hidden",!e)}},{key:"highlightWeb",value:function(e){this.radar.getWebs(e).classed("highlight",!0)}},{key:"clearWebHighlights",value:function(){this.radar.getWebs("highlight").classed("highlight",!1)}},{key:"setSong",value:function(e){if("string"==typeof e){if(this.song&&e==this.song.track)return;e=u.lookup(e)}e!=this.song&&(this.song=e,this.radar.transitionSong(e),this.updateHeading())}},{key:"transitionSong",value:function(e){this.setSong(e)}},{key:"setYear",value:function(e){this.slider.setYear(e)}},{key:"updateHeading",value:function(){var e=this.song?this.song.artist+" - "+this.song.track:"";this.heading.select(".main").text(e),this.song&&this.setYear(this.song.year)}}]),e}(),h=function(){function e(t){r(this,e);this.svg=t.append("svg").attr("viewbox","0 0 500 50").attr("preserveAspectRatio","xMidYMid meet").classed("year-slider",!0),this.svg.append("defs").html('<filter x="0" y="0" width="1" height="1" id="highlight">\n        <feFlood flood-color="yellow"/>\n        <feComposite in="SourceGraphic"/>\n      </filter>');this.y=100/3;var n=this.svg.append("g").classed("slider",!0);this.scale=d3.scaleLinear().domain(l.year_range).range([0,500]);n.append("line").classed("track",!0).attr("x1",this.scale.range()[0]).attr("x2",this.scale.range()[1]).attr("y1",this.y).attr("y2",this.y).attr("stroke","#000").attr("stroke-width",1);this.marker=this.svg.append("g").classed("marker",!0).attr("transform","translate(0, "+this.y+")"),this.marker.append("text").classed("year",!0).attr("filter","url(#highlight)").attr("y",0)}return o(e,[{key:"setYear",value:function(e){var t=this.scale(e);this.year_set?this.marker.select("text").text(e).transition("yearswing").duration(1500).ease(d3.easeCubic).attr("x",t):(this.year_set=!0,this.marker.select("text").attr("x",t).text(e))}}]),e}();t.StickySongGraphic=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={danceability:['<a href="https://www.youtube.com/watch?v=n7RuIga3vdk">It\'s got a good beat, and you can dance to it!</a>',"The <b>danceability</b> score is a measure of how suitable a song is to dance to. <i>Believe</i> is a real banger, so it's a little surprising it wasn't rated 100% on this scale. However, it's important to note that these scores don't come from kids on American Bandstand - they come from a computer. Danceability is calculated algorithmically using criteria like the tempo and the strength and regularity of the beat.",'The latter might explain why this song didn\'t reach the top of the danceability scale. The song features two sections dominated by synth pads, with no percussion: the intro, and a breakdown following the bridge. Our algorithm is very likely to "lose the beat" during these sections, and therefore ding the danceability score.'],tempo:["<b>Tempo</b> is the simplest, most primitive sonic feature in our toolbox. It's just the speed of the song. <i>Believe</i> clocks in at a moderately fast 133 beats per minute.","Computers are generally pretty good at guessing a song's tempo (<i>Believe</i>'s official sheet music gives the tempo as a \"moderate disco beat\" of 132 bpm - not bad!). But when they do fail, they tend to fail pretty spectacularly. The most common failure mode is to guess half the actual tempo (e.g. because of a weak 2nd and 4th beat), or double it (e.g. because of a strong hi-hat on the eigth notes)."],energy:['<b>Energy</b> is a measure of a track\'s "intensity". This might seem similar to danceability, but a song can be energetic (fast, loud, noisy), but undanceable because of a disjointed or weak beat.','<i>Believe</i>, with its <a href="https://www.youtube.com/watch?v=Lxc2nCmZzrs">"boots and pants"</a> techno beat and throbbing synths gets a very high energy score.'],acousticness:["<b>Acousticness</b> is how likely the algorithm thinks it is that this song was recorded acoustically (i.e. without electronic instruments or effects).","Cher's extravagantly autotuned vocals - a famous and trendsetting feature of the song - aren't fooling anyone. Not even a computer. This song is 0% acoustic."],liveness:["<b>Liveness</b> is how likely the algorithm thinks it is that this song was recorded live. Again, <i>Believe</i>'s heavy-handed production leads to a very low score on this metric."],speechiness:['<b>Speechiness</b> is a measure of the amount of spoken-word (as opposed to singing) in the track. <i>Believe</i> gets a low score here, though not quite 0 (perhaps because of the "I don\'t need you anymore" section of the bridge, which has a somewhat speechy feel).'],instrumentalness:["<b>Instrumentalness</b> is the estimated likelihood that this is an instrumental track. <i>Believe</i>, with its prominent vocals throughout, gets a 0 on this."],valence:['Finally, <b>valence</b> is one of the most high-level, abstract features used. It represents the "positiveness" of the track. That is, is listening to it likely to make you happy? Or does it have more of a sad, dark vibe?',"<i>Believe</i> gets a slightly below average 48% valence score. We might agree with that based on the lyrics (\"I really don't think it's strong enough\"), but the algorithm only has access to the raw audio of the song, not the liner notes. Its assessment of valence comes from the song's sound.","I would tend to agree that <i>Believe</i> doesn't sound like sunshine and rainbows, but it's hard to say exactly why. It's commonly observed that songs in a \n      <a href=\"https://www.youtube.com/watch?v=-9YopDo5_xU\">major key</a>\n      tend to sound more upbeat and positive than those written in a \n      <a href=\"https://www.youtube.com/watch?v=jcA--c2U4Wg\">minor key</a>,\n      but <i>Believe</i> is in the key of G major, so the answer isn't that simple.","Maybe there's just something unsettling about the alien, artificial sound of those synth pads? Or maybe it's something in the harmonies. The arpeggiated chord played after the first line of the chorus sounds a bit wonky: it's a major seventh, inverted such that the first two notes are separated by a semitone - an extremely dissonant interval. Or maybe it's just Cher's creepy robot voice."]};t.attr_texts=i}]);